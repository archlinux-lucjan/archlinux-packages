# Maintainer: Michael Bolden <me@sm9.dev>
# Maintainer: Piotr GÃ³rski <lucjan.lucjanov@gmail.com>

pkgname=cachyos-hooks-git
gitname=cachyos-hooks
pkgver=20221122.r17.g3414a5a
pkgrel=1
pkgdesc='Cachy OS Pacman Hooks'
groups=('cachyos')
arch=('any')
license=('GPL3')
url=https://github.com/cachyos/$pkgname/master
source=("git+https://github.com/sirlucjan/cachyos-hooks")
sha512sums=('SKIP')
replaces=('cachyos-hooks')
provides=('cachyos-hooks')
conflicts=('cachyos-hooks')

pkgver() {
  cd $gitname
  echo "$(git show --format='%cI' -q master | sed 's/T.*//g;s/-//g').r$(git rev-list --count HEAD).g$(git rev-parse --short HEAD)"
}

package() {
  cd $gitname
  local hooks=$pkgdir/usr/share/libalpm/hooks
  local bin=$pkgdir/usr/bin

  install -Dm644 lsb-release.hook                 $hooks/lsb-release.hook
  install -Dm644 os-release.hook                  $hooks/os-release.hook
  install -Dm644 ${gitname}.hook                  $hooks/${gitname}.hook
  install -Dm644 cachyos-reboot-required.hook     $hooks/cachyos-reboot-required.hook

  install -Dm755 cachyos-reboot-required          $bin/cachyos-reboot-required
  install -Dm755 cachyos-check-reboot-required    $bin/cachyos-check-reboot-required
  install -Dm755 ${gitname}-runner                $bin/${gitname}-runner
}
