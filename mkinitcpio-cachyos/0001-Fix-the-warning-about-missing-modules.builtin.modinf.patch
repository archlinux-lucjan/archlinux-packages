From e513272f9a30eb3a11c6787228a97c0afd201506 Mon Sep 17 00:00:00 2001
From: Chih-Hsuan Yen <yan12125@gmail.com>
Date: Sun, 3 Jul 2022 11:03:10 +0800
Subject: [PATCH] Fix the warning about missing modules.builtin.modinfo

> depmod: WARNING: could not open modules.builtin.modinfo at /tmp/mkinitcpio.EftMSK/root/lib/modules/5.15.52-1-lts: No such file or directory

kmod wants modules.builtin.modinfo since v30 [1].

Also adds modules.order as suggested by heftig. That file is used (if
exists) since the first commit of depmod.

[1] https://git.kernel.org/pub/scm/utils/kernel/kmod/kmod.git/commit/?id=0246e06340df292b5dda4bc00e24cc9ae894e881
---
 functions | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/functions b/functions
index 3b1da9b..3491caf 100644
--- a/functions
+++ b/functions
@@ -897,8 +897,7 @@ install_modules() {
     (( ${#zst_comp[*]} )) && zstd -d --rm -q "${zst_comp[@]}"
 
     msg "Generating module dependencies"
-    install -m644 -t "$moduledest" "$_d_kmoduledir"/modules.builtin
-    install -m644 -t "$moduledest" "$_d_kmoduledir"/modules.order
+    install -m644 -t "$moduledest" "$_d_kmoduledir"/modules.{builtin,builtin.modinfo,order}
     depmod -b "$BUILDROOT" "$KERNELVERSION"
 
     # remove all non-binary module.* files (except devname for on-demand module loading)
-- 
2.37.1.377.g679aad9e82

