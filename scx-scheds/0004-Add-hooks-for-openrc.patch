From 97ad2b43d39ee7633edc9bf9a5ca87868f34a484 Mon Sep 17 00:00:00 2001
From: Piotr Gorski <lucjan.lucjanov@gmail.com>
Date: Fri, 10 May 2024 18:12:10 +0200
Subject: [PATCH 4/5] Add hooks for openrc

Signed-off-by: Piotr Gorski <lucjan.lucjanov@gmail.com>
---
 .../openrc/hooks/90-scx-scheds-install.hook   | 19 +++++++++++++++++++
 .../openrc/hooks/90-scx-scheds-upgrade.hook   | 19 +++++++++++++++++++
 libalpm/openrc/hooks/meson.build              |  8 ++++++++
 meson.build                                   |  4 ++++
 4 files changed, 50 insertions(+)
 create mode 100644 libalpm/openrc/hooks/90-scx-scheds-install.hook
 create mode 100644 libalpm/openrc/hooks/90-scx-scheds-upgrade.hook
 create mode 100644 libalpm/openrc/hooks/meson.build

diff --git a/libalpm/openrc/hooks/90-scx-scheds-install.hook b/libalpm/openrc/hooks/90-scx-scheds-install.hook
new file mode 100644
index 0000000..4649cc6
--- /dev/null
+++ b/libalpm/openrc/hooks/90-scx-scheds-install.hook
@@ -0,0 +1,19 @@
+[Trigger]
+Type = Path
+Operation = Install
+Target = etc/conf.d/scx
+Target = etc/default/scx
+Target = etc/init.d/scx
+Target = usr/bin/scx_*
+
+[Trigger]
+Type = Package
+Operation = Install
+Target = scx-scheds
+Target = scx-scheds-git
+
+[Action]
+Description = Enable scx_scheduler...
+When = PostTransaction
+Exec = /usr/bin/rc-update add scx boot
+NeedsTargets
diff --git a/libalpm/openrc/hooks/90-scx-scheds-upgrade.hook b/libalpm/openrc/hooks/90-scx-scheds-upgrade.hook
new file mode 100644
index 0000000..222d4a6
--- /dev/null
+++ b/libalpm/openrc/hooks/90-scx-scheds-upgrade.hook
@@ -0,0 +1,19 @@
+[Trigger]
+Type = Path
+Operation = Install
+Target = etc/conf.d/scx
+Target = etc/default/scx
+Target = etc/init.d/scx
+Target = usr/bin/scx_*
+
+[Trigger]
+Type = Package
+Operation = Upgrade
+Target = scx-scheds
+Target = scx-scheds-git
+
+[Action]
+Description = Restart scx_scheduler...
+When = PostTransaction
+Exec = /usr/bin/rc-service scx restart
+NeedsTargets
diff --git a/libalpm/openrc/hooks/meson.build b/libalpm/openrc/hooks/meson.build
new file mode 100644
index 0000000..5e1be84
--- /dev/null
+++ b/libalpm/openrc/hooks/meson.build
@@ -0,0 +1,8 @@
+# Install the 'pacman hooks' file to the pacman hooks directory
+
+install_data(
+    [
+      '90-scx-scheds-install.hook', '90-scx-scheds-upgrade.hook'
+    ],
+    install_dir: '/usr/share/libalpm/hooks'
+  )
diff --git a/meson.build b/meson.build
index da0ed49..0cce5f0 100644
--- a/meson.build
+++ b/meson.build
@@ -333,3 +333,7 @@ libalpm = dependency('libalpm', required: get_option('libalpm'))
 if libalpm.found() and systemd.found()
   subdir('libalpm/systemd/hooks')
 endif
+
+if libalpm.found() and openrc.found()
+  subdir('libalpm/openrc/hooks')
+endif
-- 
2.44.0.325.g11c821f2f2

