From d15a19b7a658ea755c5b0f52f24736f3257719a5 Mon Sep 17 00:00:00 2001
From: Piotr Gorski <lucjan.lucjanov@gmail.com>
Date: Tue, 2 Sep 2025 20:37:35 +0200
Subject: [PATCH 5/5] scx-scheds: drop openrc support and scx.service

Signed-off-by: Piotr Gorski <lucjan.lucjanov@gmail.com>
---
 meson.build                  |  6 ---
 meson.options                |  6 ---
 services/README.md           | 79 ------------------------------------
 services/openrc/meson.build  | 23 -----------
 services/openrc/scx.initrd   | 15 -------
 services/scx                 |  5 ---
 services/systemd/meson.build |  6 ---
 services/systemd/scx.service | 14 -------
 8 files changed, 154 deletions(-)
 delete mode 100644 services/README.md
 delete mode 100644 services/openrc/meson.build
 delete mode 100755 services/openrc/scx.initrd
 delete mode 100644 services/scx
 delete mode 100644 services/systemd/scx.service

diff --git a/meson.build b/meson.build
index d33638e2..7c7bdff3 100644
--- a/meson.build
+++ b/meson.build
@@ -494,9 +494,3 @@ systemd = dependency('systemd', required: get_option('systemd'))
 if systemd.found()
   subdir('services/systemd')
 endif
-
-openrc = dependency('openrc', required: get_option('openrc'))
-
-if openrc.found()
-  subdir('services/openrc')
-endif
diff --git a/meson.options b/meson.options
index da27bbd8..b90534ec 100644
--- a/meson.options
+++ b/meson.options
@@ -32,12 +32,6 @@ option(
   value: 'auto',
   description: 'sd-notify support via libsystemd and install systemd unit files'
 )
-option(
-  'openrc',
-  type: 'feature',
-  value: 'auto',
-  description: 'openrc init.d service file'
-)
 option(
   'build_outside_src',
   type: 'boolean',
diff --git a/services/README.md b/services/README.md
deleted file mode 100644
index 4e850d0d..00000000
--- a/services/README.md
+++ /dev/null
@@ -1,79 +0,0 @@
-# A Quick Start Guide
-
-This guide provides instructions for running the SCX schedulers as a systemd service and checking its logs.
-
-## Getting Started
-
-At the very beginning, configure the /etc/default/scx file:
-
-- in the SCX_SCHEDULER variable, select the scheduler you are interested in
-
-- in the SCX_FLAGS variable, specify the flags you want to add. To do this, execute and read what flags you can add.
-
-```
-scx_SCHEDNAME --help
-```
-
-To start the SCX scheduler at boot, you need to run the systemd service as root. Here are the steps:
-
-
-- Enable the service:
-
-```
-systemctl enable scx.service
-```
-
-- Start the service:
-
-```
-systemctl start scx.service
-```
-
-Alternatively, you can use a shortened version of these commands:
-
-```
-systemctl enable --now scx.service
-```
-
-- To check the status of the service, use the following command:
-
-```
-systemctl status scx.service
-```
-
-## Override global configuration
-
-It is possible to override the global scx settings using systemd environment
-variables `SCX_SCHEDULER_OVERRIDE` and `SCX_FLAGS_OVERRIDE`.
-
-Example:
-
-```
-systemctl set-environment SCX_SCHEDULER_OVERRIDE=scx_rustland
-systemctl set-environment SCX_FLAGS_OVERRIDE="-s 10000"
-systemctl restart scx
-```
-
-If you want to restore the default value from the `/etc/default/scx` file execute:
-
-```
-systemctl unset-environment SCX_SCHEDULER_OVERRIDE
-systemctl unset-environment SCX_FLAGS_OVERRIDE
-systemctl restart scx
-```
-
-## Checking journald Logs
-
-
-- To view the logs, use the following command:
-
-```
-journalctl -u scx.service
-```
-
-- To view the logs of the current session use the command
-
-```
-journalctl -u scx.service -b 0
-```
-
diff --git a/services/openrc/meson.build b/services/openrc/meson.build
deleted file mode 100644
index 45000e91..00000000
--- a/services/openrc/meson.build
+++ /dev/null
@@ -1,23 +0,0 @@
-# Install the 'scx.initrd' file to /etc/init.d/scx
-install_data('scx.initrd', install_dir: '/etc/init.d', rename: 'scx')
-
-# Install the 'scx' file to the '/etc/default' directory
-install_data('../scx', install_dir: '/etc/default')
-
-# Symlinking /etc/default/scx to /etc/conf.d/scx
-install_symlink(
-      'scx',
-      pointing_to: '/etc/default/scx',
-      install_dir: '/etc/conf.d'
-)
-# meson.add_install_script(
-    # 'sh', '-c',
-    # 'mkdir -p $(dirname $DESTDIR/@0@/@1@)'.format(systemd_system_unit_dir,
-    #     'multi-user.target.wants/phosphor-certificate-manager@nslcd.service'),
-# )
-# meson.add_install_script(
-    # 'sh', '-c',
-    # 'ln -s @0@ $DESTDIR/@1@/@2@'.format('../phosphor-certificate-manager@.service',
-    #     systemd_system_unit_dir,
-    #     'multi-user.target.wants/phosphor-certificate-manager@nslcd.service'),
-# )
diff --git a/services/openrc/scx.initrd b/services/openrc/scx.initrd
deleted file mode 100755
index 1b40a2cb..00000000
--- a/services/openrc/scx.initrd
+++ /dev/null
@@ -1,15 +0,0 @@
-#!/usr/bin/openrc-run
-# Powered by CachyOS Team
-# Distributed under the terms of the GNU General Public License v2
-
-description="Start scx_scheduler"
-supervisor=supervise-daemon
-required_files="/etc/default/scx"
-
-command="/usr/bin/$SCX_SCHEDULER"
-command_args="$SCX_FLAGS"
-command_user="${SCX_USER:-root}:${SCX_GROUP:-root}"
-
-# stop_post() {
-# 	rm -rf /var/cache/"${RC_SVCNAME}"
-# }
diff --git a/services/scx b/services/scx
deleted file mode 100644
index ffac1756..00000000
--- a/services/scx
+++ /dev/null
@@ -1,5 +0,0 @@
-# List of scx_schedulers: scx_bpfland scx_central scx_flash scx_lavd scx_layered scx_nest scx_p2dq scx_qmap scx_rlfifo scx_rustland scx_rusty scx_simple scx_tickless scx_userland
-SCX_SCHEDULER=scx_flash
-
-# Set custom flags for each scheduler, below is an example of how to use
-#SCX_FLAGS='-m performance -D -L'
diff --git a/services/systemd/meson.build b/services/systemd/meson.build
index ac856b1e..8716b967 100644
--- a/services/systemd/meson.build
+++ b/services/systemd/meson.build
@@ -1,9 +1,6 @@
 # Get the directory for systemd system unit files
 systemd_system_unit_dir = systemd.get_variable(pkgconfig : 'systemdsystemunitdir')
 
-# Install the 'scx.service' file to the systemd system unit directory
-install_data('scx.service', install_dir: systemd_system_unit_dir)
-
 # Install the 'scx_loader.service' file to the systemd system unit directory
 install_data('scx_loader.service', install_dir: systemd_system_unit_dir)
 
@@ -12,6 +9,3 @@ install_data('org.scx.Loader.service', install_dir: '/usr/share/dbus-1/system-se
 
 # Install the default 'scx_loader' config file to the '$VENDORDIR/scx_loader' directory
 install_data('../scx_loader.toml', rename: 'config.toml', install_dir: get_option('vendordir') + '/scx_loader')
-
-# Install the 'scx' file to the '/etc/default' directory
-install_data('../scx', install_dir: '/etc/default')
diff --git a/services/systemd/scx.service b/services/systemd/scx.service
deleted file mode 100644
index 70be6975..00000000
--- a/services/systemd/scx.service
+++ /dev/null
@@ -1,14 +0,0 @@
-[Unit]
-Description=Start scx_scheduler
-StartLimitIntervalSec=30
-StartLimitBurst=2
-
-[Service]
-Type=simple
-EnvironmentFile=/etc/default/scx
-ExecStart=/bin/bash -c 'exec ${SCX_SCHEDULER_OVERRIDE:-$SCX_SCHEDULER} ${SCX_FLAGS_OVERRIDE:-$SCX_FLAGS} '
-Restart=on-failure
-StandardError=journal
-
-[Install]
-WantedBy=graphical.target
-- 
2.51.0

